Step,Instruction
1,"Read this file fully; you are an AI developer taking over the SSOT Codegen pipeline (model-driven, single-source-of-truth generation)."
2,"Understand goal: Prisma schema is the only human-edited truth; pipeline generates DTOs, validators, routes, controllers, services, auth, OpenAPI, SDK, tests, telemetry."
3,Recognize architecture layers: Prisma→DMMF→Normalization→Generators→/gen outputs→Manifest→Extensions.
4,"Note: current repo is an MVP/POC; some parts stubbed; prioritize determinism, path aliasing, and manifest enforcement."
5,Key principle: no manual edits in /gen; all customization lives in /src/extensions/*.ext.ts hooks (future work).
6,"Understand added v0.4.0 capability: dynamic import paths via path resolver, barrels, and alias (default @gen)."
7,"Outputs are layer-first, per-model subfolders; files named model.artifact.suffix.ts (e.g., user.create.dto.ts)."
8,"Manifest stores schema hash, tool version, outputs, and (v0.4.0) a path map for audit."
9,"OpenAPI is the single contract for client SDKs; even in POC, verify openapi.json emits for each model path."
10,"Performance direction: one normalization pass, hash-based skip-writes, batched FS I/O, safe parallel generation."
11,Ensure Node.js >= 18 and pnpm >= 9 are installed in the environment.
12,Confirm TypeScript >= 5.4 and Prisma CLI >= 5.x are available.
13,Open the monorepo workspace with /packages and /examples directories.
14,"Review root files: package.json, tsconfig.base.json, README.md, TECHNOTES.md."
15,"Review packages: @ssot-codegen/core, gen, templates-default, sdk-runtime, schema-lint."
16,Open examples/minimal as a consumer project wired to the generator (POC mode).
17,Inspect packages/gen/src/index.ts and path-resolver.ts to understand path emission and barrels.
18,"Inspect templates-default stubs to see intended template families (contracts, validators, routes, etc.)."
19,Check schema-lint and sdk-runtime stubs for interfaces and intended extension points.
20,"Scan TECHNOTES.md for milestones, tech debt, complexity risks, performance guidelines."
21,Run: pnpm install (workspace bootstrap).
22,Run: pnpm -r --filter ./packages/* run build (compile TypeScript packages).
23,Verify each package produced /dist with index.js and types.
24,"Run: node packages/gen/dist/cli.js --out=./examples/minimal/gen --models=User,Post (POC generation)."
25,Confirm the command completes without errors and logs the number of generated files.
26,"Open ./examples/minimal/gen and verify contracts/, validators/, routes/, controllers/, services/, loaders/, telemetry/, openapi/, manifests/."
27,Open ./examples/minimal/gen/openapi/openapi.json and verify paths exist for /user and /post (POC).
28,"Open ./examples/minimal/gen/manifests/build.json and verify schemaHash, toolVersion, outputs, and pathMap when present."
29,Verify layer barrels (gen/contracts/index.ts) and per-model barrels (gen/contracts/user/index.ts).
30,"Verify controller files import DTOs using alias (e.g., import type {...} from '@gen/contracts/user')."
31,Generate or verify tsconfig.paths.json mapping @gen/* → gen/* at repo root (emitted by generator or created manually).
32,"If needed, extend the consumer tsconfig to include tsconfig.paths.json for builds."
33,Validate alias resolution by running tsc in examples/minimal (or a dry build) to ensure imports resolve.
34,Ensure all emitted import paths are POSIX-style; no OS-specific separators.
35,Search /gen for '../../../' patterns; none should exist in imports; only alias-based imports.
36,Run a path audit: read manifests/build.json.pathMap and ensure all FS targets exist (POC path-audit if present).
37,"If path audit fails, fix resolver rules or barrel emission to point at correct targets."
38,"Document the final import policy: alias-first imports, barrels enabled, per-model folders, no cross-model direct imports."
39,"From examples/minimal, run: node scripts/generate.js (calls generator CLI with --models=User,Post)."
40,Verify generation placed files in ./examples/minimal/gen (POC).
41,Open a few representative files to ensure @generated headers are present.
42,Open controllers to confirm type-only DTO imports (import type {...}).
43,Check openapi.json contains components.schemas for UserReadDTO and PostReadDTO.
44,Check telemetry stubs (gen/telemetry/*.ts) are emitted for both models.
45,Verify manifests/build.json lists all outputs with relative paths under gen/.
46,"Ensure per-model folders exist under each layer (e.g., gen/services/user/user.service.ts)."
47,Create a tiny consumer TS file in examples/minimal/src importing from @gen/contracts to confirm types resolve.
48,Compile that tiny consumer (tsc) and ensure module resolution succeeds.
49,Add a smoke test that dynamically imports a generated controller to ensure ESM is valid.
50,"Run node -e ""import('./examples/minimal/gen/controllers/user/user.controller.ts')"" (compile first if necessary)."
51,Add a placeholder lint step; real ESLint config will be a later milestone.
52,"Validate openapi.json structure (openapi, info, paths, components) by parsing JSON in a quick script."
53,Optionally serve openapi.json using a docs viewer locally (manual step).
54,Confirm @ssot-codegen/sdk-runtime compiles and exports createClient.
55,"Record verification results in TECHNOTES.md (what worked, failures, follow-ups)."
56,Fix any TypeScript errors by updating path mapping or emitted imports.
57,"Verify package.json fields: type=module, exports/types entries present."
58,Re-run: pnpm -r run build; ensure clean compile with no errors.
59,Set version to 0.4.0 for the delta; note changes in TECHNOTES.md.
60,"Perform a dry-run publish checklist: dist bundles exist, README present, no unintended files included."
61,Check peerDependencies for prisma and other pinned ranges for stability.
62,Re-run generation twice; diff gen/ to verify deterministic outputs.
63,"Note any non-determinism in TECHNOTES.md and identify sources (timestamps, ordering, hashes)."
64,Document external consumption: install gen + templates; add generator block; run prisma generate.
65,Draft a CI plan: run generation and compare schemaHash in build.json before building/publishing.
66,"Outline a GitHub Action that builds, generates, and runs a manifest/path audit step."
67,Add CONTRIBUTING note: never edit files in /gen; use extension hooks when available.
68,Verify license headers or repository license exist where required.
69,"Confirm monorepo installs, builds, and emits dist bundles for all packages without TS errors."
70,Confirm generator CLI writes /gen with per-model folders and alias-based imports.
71,Confirm openapi.json includes a path for each model passed via --models (POC).
72,Confirm barrels exist at layer and model levels; importing from @gen/contracts/user works.
73,Confirm tsconfig.paths.json maps @gen/* to gen/* (or document manual step).
74,Confirm manifest exists and lists outputs; pathMap entries resolve to files.
75,Confirm consumer TS file compiles with imports from @gen/...
76,Confirm no deep relative imports in /gen; alias-only imports verified.
77,"Confirm README and TECHNOTES state goals, milestones, limitations."
78,Confirm version 0.4.0 recorded for this change set.
79,"Propose real Prisma DMMF ingestion (getDMMF) and schema comment-tag parsing (@route, @auth, @expose, @readonly, @example)."
80,Propose integrating a template engine (Handlebars/EJS) with partials and helpers; move logic from templates to helpers.
81,Design an auth policy compiler to reduce RBAC/ABAC to Prisma where filters and field masks; compile once per model.
82,"Implement projection presets (list/read/detail) and align DTOs, services, and OpenAPI responses."
83,"Implement filter/sort allowlists based on indexes, type-aware operators, and safe order-by sets."
84,"Ensure Zod parity with DTOs (optional vs nullable semantics, PATCH shape, error messages with path)."
85,"Complete OpenAPI (components/schemas for all DTOs, security schemes, examples, RFC7807 error model)."
86,Generate a typed client SDK from OpenAPI and optional React Query hooks; support ETag/idempotency keys.
87,"Create schema-lint rules: naming, tag validation, exposure safety, index coverage, deprecation markers."
88,"Add performance features: hash-based skip writes, batched FS ops, parallel per-model generation, unchanged-layer short-circuit."
