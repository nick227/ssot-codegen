/**
 * Validator Generator - Generates Zod validation schemas
 */

import type { ParsedModel, ParsedField } from '../dmmf-parser.js'
import { mapPrismaToZod } from '../type-mapper.js'

/**
 * Generate Create validator
 */
export function generateCreateValidator(model: ParsedModel): string {
  const fields = model.createFields.map(field => {
    const zodSchema = mapPrismaToZod(field)
    return `  ${field.name}: ${zodSchema}`
  }).join(',\n')
  
  return `// @generated
// This file is automatically generated. Do not edit manually.

import { z } from 'zod'

export const ${model.name}CreateSchema = z.object({
${fields}
})

export type ${model.name}CreateInput = z.infer<typeof ${model.name}CreateSchema>
`
}

/**
 * Generate Update validator (partial of create)
 */
export function generateUpdateValidator(model: ParsedModel): string {
  return `// @generated
// This file is automatically generated. Do not edit manually.

import { z } from 'zod'
import { ${model.name}CreateSchema } from './${model.name.toLowerCase()}.create.zod.js'

export const ${model.name}UpdateSchema = ${model.name}CreateSchema.partial()

export type ${model.name}UpdateInput = z.infer<typeof ${model.name}UpdateSchema>
`
}

/**
 * Generate Query validator
 */
export function generateQueryValidator(model: ParsedModel): string {
  const sortableFields = model.scalarFields
    .map(f => `'${f.name}'`)
    .join(', ')
  
  return `// @generated
// This file is automatically generated. Do not edit manually.

import { z } from 'zod'

export const ${model.name}QuerySchema = z.object({
  skip: z.coerce.number().min(0).optional(),
  take: z.coerce.number().min(1).max(100).optional().default(20),
  orderBy: z.enum([${sortableFields}]).optional(),
  where: z.object({
    // Add filterable fields based on model
  }).optional()
})

export type ${model.name}QueryInput = z.infer<typeof ${model.name}QuerySchema>
`
}

/**
 * Generate all validators for a model
 */
export function generateAllValidators(model: ParsedModel): {
  create: string
  update: string
  query: string
} {
  return {
    create: generateCreateValidator(model),
    update: generateUpdateValidator(model),
    query: generateQueryValidator(model)
  }
}

/**
 * Generate barrel export for validators
 */
export function generateValidatorsBarrel(model: ParsedModel): string {
  return `// @generated barrel
export * from './${model.name.toLowerCase()}.create.zod.js'
export * from './${model.name.toLowerCase()}.update.zod.js'
export * from './${model.name.toLowerCase()}.query.zod.js'
`
}

