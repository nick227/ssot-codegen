/**
 * Route Generator - Generates Express/Fastify routes
 */

import type { ParsedModel } from '../dmmf-parser.js'
import { toCamelCase } from '../utils/naming.js'

/**
 * Generate routes
 */
export function generateRoutes(model: ParsedModel, framework: 'express' | 'fastify' = 'express'): string {
  const modelLower = model.nameLower  // Use cached lowercase name
  const modelCamel = toCamelCase(model.name)
  
  if (framework === 'express') {
    return generateExpressRoutes(model, modelLower, modelCamel)
  } else {
    return generateFastifyRoutes(model, modelLower, modelCamel)
  }
}

/**
 * Generate Express routes
 */
function generateExpressRoutes(model: ParsedModel, modelLower: string, modelCamel: string): string {
  return `// @generated
// This file is automatically generated. Do not edit manually.

import { Router } from 'express'
import * as ${modelCamel}Controller from '@/controllers/${modelLower}'

export const ${modelCamel}Router = Router()

// List all ${model.name} records
${modelCamel}Router.get('/', ${modelCamel}Controller.list${model.name}s)

// Get ${model.name} by ID
${modelCamel}Router.get('/:id', ${modelCamel}Controller.get${model.name})

// Create ${model.name}
${modelCamel}Router.post('/', ${modelCamel}Controller.create${model.name})

// Update ${model.name}
${modelCamel}Router.put('/:id', ${modelCamel}Controller.update${model.name})
${modelCamel}Router.patch('/:id', ${modelCamel}Controller.update${model.name})

// Delete ${model.name}
${modelCamel}Router.delete('/:id', ${modelCamel}Controller.delete${model.name})

// Count ${model.name} records
${modelCamel}Router.get('/meta/count', ${modelCamel}Controller.count${model.name}s)
`
}

/**
 * Generate Fastify routes
 */
function generateFastifyRoutes(model: ParsedModel, modelLower: string, modelCamel: string): string {
  const idType = model.idField?.type === 'String' ? 'string' : 'number'
  
  return `// @generated
// This file is automatically generated. Do not edit manually.

import type { FastifyInstance } from 'fastify'
import * as ${modelCamel}Controller from '@/controllers/${modelLower}'

export async function ${modelCamel}Routes(fastify: FastifyInstance) {
  // List all ${model.name} records
  fastify.get('/', ${modelCamel}Controller.list${model.name}s)
  
  // Get ${model.name} by ID
  fastify.get<{ Params: { id: string } }>('/:id', ${modelCamel}Controller.get${model.name})
  
  // Create ${model.name}
  fastify.post('/', ${modelCamel}Controller.create${model.name})
  
  // Update ${model.name}
  fastify.put<{ Params: { id: string } }>('/:id', ${modelCamel}Controller.update${model.name})
  fastify.patch<{ Params: { id: string } }>('/:id', ${modelCamel}Controller.update${model.name})
  
  // Delete ${model.name}
  fastify.delete<{ Params: { id: string } }>('/:id', ${modelCamel}Controller.delete${model.name})
  
  // Count ${model.name} records
  fastify.get('/meta/count', ${modelCamel}Controller.count${model.name}s)
}
`
}

/**
 * Generate barrel export for routes
 */
export function generateRoutesBarrel(model: ParsedModel): string {
  return `// @generated barrel
export * from './${model.nameLower}.routes.js'
`
}


