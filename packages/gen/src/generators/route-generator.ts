/**
 * Route Generator - Generates Express/Fastify routes
 */

import type { ParsedModel } from '../dmmf-parser.js'

/**
 * Generate routes
 */
export function generateRoutes(model: ParsedModel, framework: 'express' | 'fastify' = 'express'): string {
  const modelLower = model.name.toLowerCase()
  
  if (framework === 'express') {
    return generateExpressRoutes(model, modelLower)
  } else {
    return generateFastifyRoutes(model, modelLower)
  }
}

/**
 * Generate Express routes
 */
function generateExpressRoutes(model: ParsedModel, modelLower: string): string {
  return `// @generated
// This file is automatically generated. Do not edit manually.

import { Router } from 'express'
import * as ${modelLower}Controller from '@gen/controllers/${modelLower}'

export const ${modelLower}Router = Router()

// List all ${model.name} records
${modelLower}Router.get('/', ${modelLower}Controller.list${model.name}s)

// Get ${model.name} by ID
${modelLower}Router.get('/:id', ${modelLower}Controller.get${model.name})

// Create ${model.name}
${modelLower}Router.post('/', ${modelLower}Controller.create${model.name})

// Update ${model.name}
${modelLower}Router.put('/:id', ${modelLower}Controller.update${model.name})
${modelLower}Router.patch('/:id', ${modelLower}Controller.update${model.name})

// Delete ${model.name}
${modelLower}Router.delete('/:id', ${modelLower}Controller.delete${model.name})

// Count ${model.name} records
${modelLower}Router.get('/meta/count', ${modelLower}Controller.count${model.name}s)
`
}

/**
 * Generate Fastify routes
 */
function generateFastifyRoutes(model: ParsedModel, modelLower: string): string {
  const idType = model.idField?.type === 'String' ? 'string' : 'number'
  
  return `// @generated
// This file is automatically generated. Do not edit manually.

import type { FastifyInstance } from 'fastify'
import * as ${modelLower}Controller from '@gen/controllers/${modelLower}'

export async function ${modelLower}Routes(fastify: FastifyInstance) {
  // List all ${model.name} records
  fastify.get('/', ${modelLower}Controller.list${model.name}s)
  
  // Get ${model.name} by ID
  fastify.get<{ Params: { id: string } }>('/:id', ${modelLower}Controller.get${model.name})
  
  // Create ${model.name}
  fastify.post('/', ${modelLower}Controller.create${model.name})
  
  // Update ${model.name}
  fastify.put<{ Params: { id: string } }>('/:id', ${modelLower}Controller.update${model.name})
  fastify.patch<{ Params: { id: string } }>('/:id', ${modelLower}Controller.update${model.name})
  
  // Delete ${model.name}
  fastify.delete<{ Params: { id: string } }>('/:id', ${modelLower}Controller.delete${model.name})
  
  // Count ${model.name} records
  fastify.get('/meta/count', ${modelLower}Controller.count${model.name}s)
}
`
}

/**
 * Generate barrel export for routes
 */
export function generateRoutesBarrel(model: ParsedModel): string {
  return `// @generated barrel
export * from './${model.name.toLowerCase()}.routes.js'
`
}

